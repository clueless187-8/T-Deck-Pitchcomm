name: Arduino Library CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  arduino-compile:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          # XIAO nRF52840 sketches
          - sketch: XIAO_Catcher_HUD/Catcher_HUD_Receiver_v2.ino
            board-fqbn: Seeeduino:nrf52:xiaonRF52840Sense
            board-platform-name: Seeeduino:nrf52
            board-platform-url: https://files.seeedstudio.com/arduino/package_seeeduino_boards_index.json
          - sketch: XIAO_Armband_ePaper/XIAO_Armband_ePaper.ino
            board-fqbn: Seeeduino:nrf52:xiaonRF52840Sense
            board-platform-name: Seeeduino:nrf52
            board-platform-url: https://files.seeedstudio.com/arduino/package_seeeduino_boards_index.json

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Arduino CLI
        uses: arduino/setup-arduino-cli@v1

      - name: Install board platform
        run: |
          arduino-cli config init
          arduino-cli config add board_manager.additional_urls ${{ matrix.board-platform-url }}
          arduino-cli core update-index
          arduino-cli core install ${{ matrix.board-platform-name }}

      - name: Install required libraries
        run: |
          # Install common libraries
          arduino-cli lib install "RadioLib"
          arduino-cli lib install "U8g2"
          arduino-cli lib install "GxEPD2"
          arduino-cli lib install "Adafruit GFX Library"

      - name: Compile sketch
        run: |
          arduino-cli compile --fqbn ${{ matrix.board-fqbn }} ${{ matrix.sketch }} --verbose
